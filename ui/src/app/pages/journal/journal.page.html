<ion-toolbar>
  <img
    src="assets/strawberry.svg"
    alt="Home"
    id="logo"
    slot="start"
    (click)="navigateTo('')"
  />
  <div class="filter-container" slot="start">
    <ion-item lines="none">
      <div class="date-filter" (click)="openDatePicker()">
        <i class="fa-regular fa-calendar"></i>
        <ion-datetime-button datetime="filterDate"></ion-datetime-button>
      </div>
      <ion-modal [keepContentsMounted]="true">
        <ng-template>
          <ion-datetime
            id="filterDate"
            presentation="date"
            [(ngModel)]="dateSelected"
            (ionChange)="onDateChange()"
          ></ion-datetime>
        </ng-template>
      </ion-modal>
    </ion-item>
    <ion-item lines="none" *ngIf="sharedUsers.length > 0">
      <div class="user-filter">
        <i class="fa-solid fa-user-group"></i>
        <ion-select [(ngModel)]="selectedUser" (ionChange)="onUserChange()">
          <ion-select-option value="Me">Me</ion-select-option>
          <ion-select-option
            *ngFor="let user of sharedUsers"
            [value]="user.uid"
          >
            {{ user.username }}
          </ion-select-option>
        </ion-select>
      </div>
    </ion-item>
  </div>
  <i
    class="fa-solid"
    [ngClass]="nutrientIcons[selectedNutrient]"
    slot="end"
    (click)="cycleNutrient()"
  ></i>
  <i
    class="fa-solid"
    [ngClass]="displayMode === 'numbers' ? 'fa-hashtag' : 'fa-percent'"
    slot="end"
    (click)="toggleDisplayMode()"
  ></i>
  <img
    [src]="userProfileImage"
    alt="User Profile"
    class="user-profile-image"
    slot="end"
    (click)="navigateTo('account')"
  />
</ion-toolbar>

<ion-content fullscreen>
  <div class="main-content" [class.no-entries]="journalEntries.length === 0">
    <ng-container *ngIf="journalEntries.length > 0; else noEntries">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Meal Name</th>
              <th *ngIf="!isMobile || selectedNutrient === 'calories'">
                Calories
              </th>
              <th *ngIf="!isMobile || selectedNutrient === 'carbs'">Carbs</th>
              <th *ngIf="!isMobile || selectedNutrient === 'proteins'">
                Protein
              </th>
              <th *ngIf="!isMobile || selectedNutrient === 'fats'">Fats</th>
              <th *ngIf="!isMobile">Time</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entry of journalEntries">
              <td>{{ entry.summary }}</td>
              <td
                *ngIf="!isMobile || selectedNutrient === 'calories'"
                class="calories"
              >
                {{ entry.calories }}
              </td>
              <td
                *ngIf="!isMobile || selectedNutrient === 'carbs'"
                class="carbs"
              >
                {{ entry.carbs }}
              </td>
              <td
                *ngIf="!isMobile || selectedNutrient === 'proteins'"
                class="protein"
              >
                {{ entry.proteins }}
              </td>
              <td *ngIf="!isMobile || selectedNutrient === 'fats'" class="fats">
                {{ entry.fats }}
              </td>
              <td *ngIf="!isMobile">{{ entry.formattedMealTime }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>

    <ng-template #noEntries>
      <div class="no-entries-container">
        <img
          src="assets/nomeal.svg"
          alt="No Meal Entries"
          class="no-meal-image"
        />
      </div>
    </ng-template>

    <div
      class="bottom-content"
      [class.no-entries]="journalEntries.length === 0"
    >
      <div class="chart-container" *ngIf="journalEntries.length > 0">
        <canvas
          baseChart
          class="chart"
          [data]="pieChartData"
          [type]="pieChartType"
          [options]="pieChartOptions"
        ></canvas>
      </div>
      <div class="add-meal" *ngIf="selectedUser === 'Me'">
        <h2>Add a Meal</h2>
        <div class="input-wrapper">
          <input
            type="text"
            [(ngModel)]="newMealDescription"
            placeholder="What else did you eat?"
            (keydown.enter)="addNewMeal()"
            [disabled]="isLoadingNewMeal"
          />
          <ng-container *ngIf="!isLoadingNewMeal">
            <ion-icon name="arrow-up" (click)="addNewMeal()"></ion-icon>
          </ng-container>
          <ng-container *ngIf="isLoadingNewMeal">
            <ion-spinner name="dots"></ion-spinner>
          </ng-container>
        </div>
        <ion-item lines="none">
          <ion-label>Favorites</ion-label>
          <ion-select
            [(ngModel)]="selectedFavoriteMeal"
            (ionChange)="onFavoriteMealSelected()"
            interface="action-sheet"
          >
            <ion-select-option
              *ngFor="let favorite of favoriteMeals"
              [value]="favorite"
            >
              {{ favorite.summary }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>
    </div>
  </div>
</ion-content>
